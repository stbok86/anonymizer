#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ government_org
"""
import pandas as pd
import os
import re
import json

def comprehensive_government_org_analysis():
    """
    –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ government_org –≤–∫–ª—é—á–∞–µ—Ç:
    1. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑ Excel
    2. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ nlp_config.json
    3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö
    4. –û—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
    """
    
    print("üèõÔ∏è –ö–û–ú–ü–õ–ï–ö–°–ù–ê–Ø –û–¶–ï–ù–ö–ê –ê–õ–ì–û–†–ò–¢–ú–ê –î–ï–¢–ï–ö–¶–ò–ò GOVERNMENT_ORG")
    print("="*70)
    
    # 1. –ê–ù–ê–õ–ò–ó –ü–ê–¢–¢–ï–†–ù–û–í
    print("\n1Ô∏è‚É£ –ê–ù–ê–õ–ò–ó –ü–ê–¢–¢–ï–†–ù–û–í")
    print("-" * 30)
    
    excel_path = os.path.join(os.path.dirname(__file__), "nlp_patterns.xlsx")
    try:
        df = pd.read_excel(excel_path)
        gov_patterns = df[df['category'] == 'government_org']
        
        print(f"üìä –ù–∞–π–¥–µ–Ω–æ {len(gov_patterns)} –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è government_org:")
        
        pattern_effectiveness = []
        test_cases = [
            "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –∏ —Å–≤—è–∑–∏ –ü–µ—Ä–º—Å–∫–æ–≥–æ –∫—Ä–∞—è",
            "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—É–∫–∏ –ö–∏—Ä–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏",
            "–§–µ–¥–µ—Ä–∞–ª—å–Ω–∞—è —Å–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏",
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ–ª –ø–æ –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏",
            "–ö–æ–º–∏—Ç–µ—Ç –ø–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞",
            "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –†–§",
            "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±–æ—Ä–æ–Ω—ã –†–æ—Å—Å–∏–∏",
            "–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –ø–æ —Ç—É—Ä–∏–∑–º—É",
            "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ä–æ–¥–∞ –ü–µ—Ä–º–∏",
            "–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞ –ü–µ—Ä–º—Å–∫–æ–≥–æ –∫—Ä–∞—è",
            "–°—á–µ—Ç–Ω–∞—è –ø–∞–ª–∞—Ç–∞ –†–§",
            "–§–ù–° –†–æ—Å—Å–∏–∏",
            "–†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä",
            "–ú–∏–Ω–æ–±—Ä–Ω–∞—É–∫–∏ –†–æ—Å—Å–∏–∏",
            "–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ü–µ—Ä–º—Å–∫–æ–≥–æ –∫—Ä–∞—è",
            "–ì–æ—Ä–æ–¥—Å–∫–∞—è –¥—É–º–∞ –ü–µ—Ä–º–∏",
            "–ú–í–î –†–§",
            "–ú–∏–Ω–∑–¥—Ä–∞–≤ –†–æ—Å—Å–∏–∏",
            "–§–µ–¥–µ—Ä–∞–ª—å–Ω–∞—è —Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è —Å–ª—É–∂–±–∞",
            "–ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–π —Ñ–æ–Ω–¥ –†–æ—Å—Å–∏–∏"
        ]
        
        for idx, row in gov_patterns.iterrows():
            pattern = row['pattern']
            description = row['description']
            confidence = row['confidence']
            
            print(f"\n   üîç {description}")
            print(f"      Regex: {pattern}")
            print(f"      –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {confidence}")
            
            try:
                compiled_pattern = re.compile(pattern, re.IGNORECASE)
                matches = 0
                matched_cases = []
                
                for test_case in test_cases:
                    match = compiled_pattern.search(test_case)
                    if match:
                        matches += 1
                        matched_cases.append(test_case)
                
                effectiveness = matches / len(test_cases) * 100
                pattern_effectiveness.append({
                    'description': description,
                    'effectiveness': effectiveness,
                    'matches': matches,
                    'matched_cases': matched_cases
                })
                
                print(f"      ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {effectiveness:.1f}% ({matches}/{len(test_cases)} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π)")
                
            except re.error as e:
                print(f"      ‚ùå –û—à–∏–±–∫–∞ regex: {e}")
        
        # 2. –ê–ù–ê–õ–ò–ó –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
        print(f"\n2Ô∏è‚É£ –ê–ù–ê–õ–ò–ó –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò")
        print("-" * 30)
        
        config_path = os.path.join(os.path.dirname(__file__), "../config/nlp_config.json")
        try:
            with open(config_path, 'r', encoding='utf-8') as f:
                config = json.load(f)
            
            gov_config = config['nlp_service_config']['detection_methods'].get('government_org', {})
            
            if gov_config:
                print("üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è government_org:")
                print(f"   –ú–µ—Ç–æ–¥—ã: {gov_config.get('enabled_methods', [])}")
                print(f"   –°—Ç—Ä–∞—Ç–µ–≥–∏—è: {gov_config.get('strategy', 'unknown')}")
                print(f"   –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤: {gov_config.get('priority_order', [])}")
                print(f"   –ú–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {gov_config.get('max_results', 'unknown')}")
                print(f"   Fallback: {gov_config.get('fallback_enabled', False)}")
                
                method_settings = gov_config.get('method_settings', {})
                for method, settings in method_settings.items():
                    print(f"   {method}: –º–∏–Ω. —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å {settings.get('min_confidence', 'N/A')}")
            else:
                print("‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è government_org –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
        
        # 3. –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê –ê–õ–ì–û–†–ò–¢–ú–ê
        print(f"\n3Ô∏è‚É£ –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê –ê–õ–ì–û–†–ò–¢–ú–ê")
        print("-" * 30)
        
        total_effectiveness = sum(p['effectiveness'] for p in pattern_effectiveness) / len(pattern_effectiveness)
        best_pattern = max(pattern_effectiveness, key=lambda x: x['effectiveness'])
        worst_pattern = min(pattern_effectiveness, key=lambda x: x['effectiveness'])
        
        print(f"üìà –û–±—â–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {total_effectiveness:.1f}%")
        print(f"ü•á –õ—É—á—à–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω: {best_pattern['description']} ({best_pattern['effectiveness']:.1f}%)")
        print(f"ü•â –•—É–¥—à–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω: {worst_pattern['description']} ({worst_pattern['effectiveness']:.1f}%)")
        
        # –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è
        all_matched = set()
        for p in pattern_effectiveness:
            all_matched.update(p['matched_cases'])
        
        coverage = len(all_matched) / len(test_cases) * 100
        print(f"üìä –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤: {coverage:.1f}% ({len(all_matched)}/{len(test_cases)})")
        
        print(f"\nüîç –ù–µ –ø–æ–∫—Ä—ã—Ç—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–ª—É—á–∞–∏:")
        uncovered = set(test_cases) - all_matched
        for case in uncovered:
            print(f"   ‚ùå {case}")
        
        # 4. –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ò –ü–†–ò–ú–ï–ù–ò–ú–û–°–¢–¨
        print(f"\n4Ô∏è‚É£ –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ò –ü–†–ò–ú–ï–ù–ò–ú–û–°–¢–¨")
        print("-" * 30)
        
        print("‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:")
        print("   ‚Ä¢ –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤")
        print("   ‚Ä¢ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∏ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–Ω–∏")
        print("   ‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π")
        print("   ‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –¥–µ—Ç–µ–∫—Ü–∏–∏")
        print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —É—Ä–æ–≤–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏")
        
        print("\n‚ö†Ô∏è –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:")
        print("   ‚Ä¢ –ù–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å")
        print("   ‚Ä¢ –°–ª–∞–±–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è (–§–ù–°, –ú–í–î)")
        print("   ‚Ä¢ –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è")
        print("   ‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞—Ä–∏–∞—Ü–∏–π –Ω–∞–ø–∏—Å–∞–Ω–∏—è")
        print("   ‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑")
        
        print("\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:")
        print("   1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤")
        print("   2. –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π")
        print("   3. –î–æ–±–∞–≤–∏—Ç—å phrase_matcher –¥–ª—è –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π")
        print("   4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å spaCy NER –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥")
        print("   5. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã")
        print("   6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑")
        
        # 5. –û–¶–ï–ù–ö–ê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–ò
        print(f"\n5Ô∏è‚É£ –û–¶–ï–ù–ö–ê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–ò")
        print("-" * 30)
        
        adaptability_score = 0
        max_score = 100
        
        # –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏
        criteria = {
            "–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã": 20,  # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
            "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å confidence": 15,  # –ï—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ regex + NLP": 15,  # –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥—ã
            "–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è": 10,  # –ï—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤
            "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å": 15,  # JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            "–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π": 15,  # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞": 5,   # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
            "–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑": 5   # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–ª—è government_org
        }
        
        # –û—Ü–µ–Ω–∫–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        scores = {
            "–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã": 18,  # –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
            "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å confidence": 14, # –ï—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ regex + NLP": 10,     # –¢–æ–ª—å–∫–æ regex –ø–æ–∫–∞
            "–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è": 8,     # –ß–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
            "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å": 15,         # –û—Ç–ª–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            "–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π": 15,   # –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è
            "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞": 2,      # –°–ª–∞–±–∞—è
            "–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑": 0      # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        }
        
        for criterion, max_points in criteria.items():
            score = scores[criterion]
            adaptability_score += score
            status = "‚úÖ" if score >= max_points * 0.8 else "‚ö†Ô∏è" if score >= max_points * 0.5 else "‚ùå"
            print(f"   {status} {criterion}: {score}/{max_points}")
        
        final_adaptability = (adaptability_score / max_score) * 100
        print(f"\nüìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–ò: {final_adaptability:.1f}%")
        
        if final_adaptability >= 80:
            rating = "üèÜ –û—Ç–ª–∏—á–Ω–∞—è"
        elif final_adaptability >= 60:
            rating = "üëç –•–æ—Ä–æ—à–∞—è"
        elif final_adaptability >= 40:
            rating = "‚ö†Ô∏è –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–∞—è"
        else:
            rating = "‚ùå –ù–∏–∑–∫–∞—è"
        
        print(f"üéØ –†–µ–π—Ç–∏–Ω–≥: {rating}")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: {e}")

if __name__ == "__main__":
    comprehensive_government_org_analysis()