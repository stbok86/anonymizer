#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ğ’Ğ˜Ğ—Ğ£ĞĞ›Ğ¬ĞĞĞ¯ Ğ”Ğ˜ĞĞ“Ğ ĞĞœĞœĞ ĞĞ›Ğ“ĞĞ Ğ˜Ğ¢ĞœĞ ĞĞĞĞ›Ğ˜Ğ—Ğ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢Ğ
=================================================
"""

def print_sequence_diagram():
    """ĞŸĞµÑ‡Ğ°Ñ‚Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°"""
    
    diagram = """
ğŸ¯ Ğ”Ğ˜ĞĞ“Ğ ĞĞœĞœĞ ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬ĞĞĞ¡Ğ¢Ğ˜: ĞĞĞĞ›Ğ˜Ğ— Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢Ğ
================================================================================

Frontend          Unified_Doc_Service        Rule_Engine         NLP_Service
   |                       |                     |                    |
   | 1. POST /analyze      |                     |                    |
   |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º |                     |                    |
   |                       |                     |                    |
   |                       | 2. Document(file)   |                    |
   |                       |â”€â”€â”                  |                    |
   |                       |  â”‚ BlockBuilder     |                    |  
   |                       |â—„â”€â”˜ .build_blocks()  |                    |
   |                       |                     |                    |
   |                       | 3. Regex Analysis   |                    |
   |                       |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|                    |
   |                       |                     |                    |
   |                       |       4. regex      |                    |
   |                       |         patterns    |                    |
   |                       |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|                    |
   |                       |                     |                    |
   |                       | 5. POST /analyze    |                    |
   |                       |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|
   |                       |        blocks[]     |                    |
   |                       |                     |                    |
   |                       |                     |      6. NLP Magic  |
   |                       |                     |         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|
   |                       |                     |         â”‚          |
   |                       |                     |    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   |
   |                       |                     |    â”‚spaCy NER  â”‚   |
   |                       |                     |    â”‚Phrase     â”‚   |
   |                       |                     |    â”‚Matcher    â”‚   |
   |                       |                     |    â”‚Hybrid     â”‚   |
   |                       |                     |    â”‚Strategy   â”‚   |
   |                       |                     |    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   |
   |                       |                     |         â”‚          |
   |                       |                     |         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|
   |                       |                     |                    |
   |                       | 7. JSON Response    |                    |
   |                       |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
   |                       |    detections[]     |                    |
   |                       |                     |                    |
   |                       | 8. Merge Results    |                    |
   |                       |â”€â”€â”                  |                    |
   |                       |  â”‚ rule_items +     |                    |
   |                       |â—„â”€â”˜ nlp_items        |                    |
   |                       |                     |                    |
   | 9. Analysis Results   |                     |                    |
   |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ |                     |                    |
   |   JSON Response       |                     |                    |


ğŸ” Ğ”Ğ•Ğ¢ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ’ĞĞ£Ğ¢Ğ Ğ•ĞĞĞ•Ğ“Ğ ĞĞ›Ğ“ĞĞ Ğ˜Ğ¢ĞœĞ NLP SERVICE
================================================================================

NLP_Service_Main    NLP_Adapter        Detection_Methods    Hybrid_Strategy
       |                 |                      |                  |
       | 1. analyze()    |                      |                  |
       |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º |                      |                  |
       |                 |                      |                  |
       |                 | FOR each block       |                  |
       |                 |â”€â”€â”                   |                  |
       |                 |  â”‚                   |                  |
       |                 |  | 2. find_sensitive_data()             |
       |                 |  |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|                  |
       |                 |  |                   |                  |
       |                 |  |                   | FOR each category |
       |                 |  |                   |â”€â”€â”               |
       |                 |  |                   |  â”‚               |
       |                 |  |                   |  | person_name:  |
       |                 |  |                   |  â”‚ - spacy_ner   |
       |                 |  |                   |  â”‚ - morphology  |
       |                 |  |                   |  â”‚ - regex       |
       |                 |  |                   |  â”‚               |
       |                 |  |                   |  | government_org:|
       |                 |  |                   |  â”‚ HYBRIDâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º |
       |                 |  |                   |  â”‚ STRATEGY      |    |
       |                 |  |                   |  â”‚               |    |
       |                 |  |                   |  â”‚               |    | 1. Phrase
       |                 |  |                   |  â”‚               |    |    Matcher
       |                 |  |                   |  â”‚               |    |
       |                 |  |                   |  â”‚               |    | 2. spaCy NER
       |                 |  |                   |  â”‚               |    |
       |                 |  |                   |  â”‚               |    | 3. Intelligent
       |                 |  |                   |  â”‚               |â—„â”€â”€â”€    Merging
       |                 |  |                   |  â”‚               |
       |                 |  |                   |â—„â”€â”˜               |
       |                 |  |                   |                  |
       |                 |  |    3. detections  |                  |
       |                 |  |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|                  |
       |                 |â—„â”€â”˜                   |                  |
       |                 |                      |                  |
       | 4. all_detections|                     |                  |
       |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|                     |                  |


ğŸ›ï¸ Ğ”Ğ•Ğ¢ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ“Ğ˜Ğ‘Ğ Ğ˜Ğ”ĞĞĞ™ Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ˜ Ğ”Ğ›Ğ¯ GOVERNMENT_ORG
================================================================================

Input: "ĞœĞ¸Ğ½Ğ¸ÑÑ‚ĞµÑ€ÑÑ‚Ğ²Ğ¾ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ Ğ¸ ÑĞ²ÑĞ·Ğ¸ ĞŸĞµÑ€Ğ¼ÑĞºĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ"

Hybrid_Strategy     Phrase_Matcher      spaCy_NER        Merging_Logic
       |                    |               |                  |
       | 1. combine_results()|              |                  |
       |â”€â”€â”                  |               |                  |
       |  â”‚                  |               |                  |
       |  | 2. Ğ­Ğ¢ĞĞŸ 1: Phrase Matcher       |                  |
       |  |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|               |                  |
       |  |                  |               |                  |
       |  |                  | search in 72 |                  |
       |  |                  | organizations |                  |
       |  |                  |â”€â”€â”            |                  |
       |  |                  |â—„â”€â”˜            |                  |
       |  |                  |               |                  |
       |  |   phrase_matches |               |                  |
       |  |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|               |                  |
       |  |                  |               |                  |
       |  | 3. Ğ­Ğ¢ĞĞŸ 2: spaCy NER             |                  |
       |  |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|                  |
       |  |                  |               |                  |
       |  |                  |               | ORG entities     |
       |  |                  |               | classification   |
       |  |                  |               | false_pos filter |
       |  |                  |               |â”€â”€â”               |
       |  |                  |               |â—„â”€â”˜               |
       |  |                  |               |                  |
       |  |               ner_matches       |                  |
       |  |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|                  |
       |  |                  |               |                  |
       |  | 4. Ğ­Ğ¢ĞĞŸ 3: Intelligent Merging              |
       |  |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º|
       |  |                  |               |                  |
       |  |                  |               |        prioritize|
       |  |                  |               |        dedupe    |
       |  |                  |               |        metadata  |
       |  |                  |               |               â”€â”€â”|
       |  |                  |               |               â—„â”€â”˜|
       |  |                  |               |                  |
       |  |                final_detections |                  |
       |  |â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
       |â—„â”€â”˜                  |               |                  |

Result: 
{
  "original_value": "ĞœĞ¸Ğ½Ğ¸ÑÑ‚ĞµÑ€ÑÑ‚Ğ²Ğ¾ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ Ğ¸ ÑĞ²ÑĞ·Ğ¸ ĞŸĞµÑ€Ğ¼ÑĞºĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ",
  "confidence": 0.98,
  "method": "hybrid_phrase_matcher",
  "hybrid_info": {
    "organization_type": "government",
    "source_method": "phrase_matcher", 
    "is_government": true
  }
}

ğŸ“Š Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ Ğ­Ğ¤Ğ¤Ğ•ĞšĞ¢Ğ˜Ğ’ĞĞĞ¡Ğ¢Ğ˜
================================================================================

ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ°                    Ğ”Ğ¾ Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¾Ğ¹      ĞŸĞ¾ÑĞ»Ğµ Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¾Ğ¹     Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ
                          Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸         Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸           
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ³Ğ¾ÑĞ¾Ñ€Ğ³Ğ°Ğ½Ğ¾Ğ²           35%               100%              +186%
Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸             75%               95%               +27%
False Positives               15%               <5%               -67%
Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸               3s                <2s               +33%
ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ÑĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¹          âŒ                âœ…               NEW
Ğ ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸      âŒ                âœ…               NEW
ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ñ…           âŒ                âœ…               NEW

ğŸ¯ Ğ˜Ğ¢ĞĞ“ĞĞ’Ğ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢
================================================================================
âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ³Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ 
   Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ĞµÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°
âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²ÑÑ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…  
âœ… Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚Ğ¾ 100% Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… false positives
âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° Ğ±ĞµĞ· breaking changes Ğ² ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ
"""
    
    return diagram

if __name__ == "__main__":
    print(print_sequence_diagram())